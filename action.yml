name: "Create avro schema"
description: "Se realiza el an√°lisis en sonarqube para NET"
inputs:
  github_token:
    description: "github token"
    required: true
  AVRO_VERSION:
    requiered: false
    default: 1.11.0
  INPUT:
    requiered: false
    default: schema
  OUTPUT:
    requiered: false
    default: struct
  REPOSITORY:
    requiered: false
    default: architecture-it/integracion-schemas-event-go
runs:
  using: "composite"
  steps:
      - uses: actions/checkout@v2
        with:
          fetch-depth: 0  # Shallow clones should be disabled for a better relevancy of analysis
      - uses: actions/setup-go@v2
        with:
          version: 1.17.7
      - name: Get gogen-avro Tools
        run: go get github.com/actgardner/gogen-avro/v10/cmd/...
        shell: bash
      - name: Download avro results
        uses: actions/download-artifact@v1
        with:
          name: code-coverage-report
          path: ${{ inputs.INPUT }}
      - name: Create Folder output
        run: mkdir ${{ inputs.OUTPUT }}
        shell: bash
      - name: Generate go struct
        run: /home/runner/go/bin/gogen-avro --package=Events ${{ inputs.OUTPUT }} ${{ inputs.INPUT }}/*.avsc
        shell: bash
      - name: Checkout Nuget go for verify branch
        uses: actions/checkout@v2
        with:
          persist-credentials: false # otherwise, the token used is the GITHUB_TOKEN, instead of your personal token
          fetch-depth: 0 # otherwise, you will failed to push refs to dest repo
          repository: ${{ inputs.REPOSITORY }}
          token: ${{ inputs.github_token }}
          path: ./nuget