name: "Create avro schema"
description: "Se realiza el an√°lisis en sonarqube para NET"
inputs:
  file_idl:
    description: "file idl with record to convert in avro"
    required: true
  AVRO_VERSION:
    requiered: false
    default: 1.11.0
  AVRO_MIRROR: 
    requiered: false
    default: http://archive.apache.org/dist/avro
  OUTPUT:
    requiered: false
    default: schema
runs:
  using: "composite"
  steps:
      - uses: actions/checkout@v2
        with:
          fetch-depth: 0  # Shallow clones should be disabled for a better relevancy of analysis
      - uses: actions/setup-java@v1
        with:
          java-version: '11' # The JDK version to make available on the path.
          java-package: jre # (jre, jdk, or jdk+fx) - defaults to jdk
          architecture: x64 # (x64 or x86) - defaults to x64
      - name: Create Folder
        run: mkdir ${{ inputs.OUTPUT }}
        shell: bash
      - name: Get Avro Tools
        run: wget --quiet ${{inputs.AVRO_MIRROR}}/avro-${{inputs.AVRO_VERSION}}/java/avro-tools-${{inputs.AVRO_VERSION}}.jar
        shell: bash
      - name: Generate Schema Protocol
        run: java -jar avro-tools-${{inputs.AVRO_VERSION}}.jar idl2schemata ${{ inputs.file_idl }} ${{ inputs.OUTPUT }}/
        shell: bash
      - name: Generate Schema Classes 
        run: java -jar avro-tools-${{inputs.AVRO_VERSION}}.jar idl ${{ inputs.file_idl }} ${{ inputs.OUTPUT }}/schemas.avpr
        shell: bash
      - name: Archive schema avro result
        uses: actions/upload-artifact@v1
        with:
          name: avro-schema
          path: ${{ inputs.OUTPUT }}
