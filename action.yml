name: "Create an issue in Repository"
description: "Registra las ocaciones en las que se reinicia un servicio"

inputs:
  motivo:
    description: 'Motivo del Restart'
    required: false
    default: ''
  test:
    description: 'Test'
    required: true
    default: 'false'
    
  qa:
    description: 'QA'
    required: true
    default: 'false'
  prod:
    description: 'Production'
    required: true
    default: 'false'

outputs:
  issueId:
    description: 'ID de la issue creada'
    value: ${{ steps.validate_format.outputs.issueId }}


runs:
  using: "composite"
  steps:

    - name: Validate Format
      id: validate_format
      uses: actions/github-script@v7
      with:
        script: |
          const owner = context.repo.owner;
          const repo = context.repo.repo;
          const inputs = {
            motivo: '${{ inputs.motivo }}',
            test: '${{ inputs.test }}',
            qa: '${{ inputs.qa }}',
            prod: '${{ inputs.prod }}'
          };

          // Person who run the action manually
          const person = context.actor;


          // Numero de action ejecutada
          const actionNumber = context.runNumber;

          const title = `Restart Service${inputs.motivo ? ` - ${inputs.motivo}` : ''}`;
          const labels = ['restart-service', 'cicd'];

          const body = `

          ## Motivo
          ${inputs.motivo}

          ## Ambientes
          - Test: ${inputs.test ? '[x]' : '[]'}
          - QA: ${inputs.qa ? '[x]' : '[]'}
          - Prod: ${inputs.prod ? '[x]' : '[]'}

          ## Número de ejecución
          ${actionNumber}

          ## Autor
          ${person}

          `;

        
          const { data: { id: issueId } } = await github.rest.issues.create({
            owner: context.repo.owner,
            repo: context.repo.repo,
            title,
            body,
            labels
          });

          core.setOutput('issueId', issueId);

    