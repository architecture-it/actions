name: "Next Version"
description: "Realiza el release basado en los commits y conventional commit"
inputs:
  github_token:
    description: Github Token
    required: true
  branches:
    description: configuration to latest release and prerelease
    default: '"main"'
    required: false
outputs:
  result:
    description: The version of the release
    value: ${{ steps.next-version.outputs.version }}

runs:
  using: "composite"
  steps:
    - name: Setup Node.js 18
      uses: actions/setup-node@v3
      with:
        node-version: 18.x
    - name: Write config file
      shell: bash
      run: |
        echo `module.exports = { plugins: ["@semantic-release/commit-analyzer", ["@semantic-release/npm", { "npmPublish": false, }], [ "@semantic-release/exec", { verifyReleaseCmd: "echo 'version=${nextRelease.version}' >> $GITHUB_OUTPUT" } ] ], branches: [ "main", "develop" ], dryRun: true };` >> release.config.js
    - name: Get the version
      run: npx -p @semantic-release/exec semantic-release
      env:
        GITHUB_TOKEN: ${{ inputs.github_token }}
        GH_TOKEN: ${{ inputs.github_token }}
      id: next-version
      shell: bash
    - name: show version
      run: echo "The new version is '${{ steps.next-version.outputs.version }}'"
      shell: bash
